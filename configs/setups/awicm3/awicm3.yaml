#########################################################################################
######################### AWICM3 YAML CONFIGURATION FILE  ###############################
#########################################################################################
general:

        compute_recipe:
              - "_create_setup_folders"
              - "_create_component_folders"
              - "initialize_experiment_logfile"
              - "_write_finalized_config"
              - "copy_tools_to_thisrun"
              - "_copy_preliminary_files_from_experiment_to_thisrun"
              - "_show_simulation_info"
              - "copy_files_to_thisrun"
              # @JAN: can you provide this sript? - "preprocess"
              - "modify_namelists"
              - "modify_files"
              - "create_new_files"
              - "prepare_coupler_files"
              - "add_batch_hostfile"
              - "copy_files_to_work"
              - "write_simple_runscript"
              - "report_missing_files"
              - "database_entry"
              - "submit"

        model: awicm3
        pool_dir: "/work/ollie/jstreffi/input"
        model_dir: ${esm_master_dir}/awicm3-${version}

        lresume: False
        coupled_setup: True

        include_models:
                - oifs
                - fesom
                - oasis3mct
                - rnfmap

        available_versions:
        - '1.0-deck'
        - '1.0'
        choose_version:
          1.0-deck:
            couplings:
            - fesom-2.0+oifs-43r3
          '1.0':
            couplings:
            - fesom-2.0+oifs-43r3+xios-2.5
            add_include_models:
            - xios

        version: "1.0-deck"
        scenario: "PI-CTRL"
        resolution: ${oifs.resolution}_${fesom.resolution}
        postprocessing: false
        post_time: "00:05:00"
        compute_time: "00:30:00"

        choose_computer.name:
                mistral:
                        runtime_environment_changes:
                                add_export_vars:
                                        # (additional) settings used in FOCI up to v1.21
                                        #- 'I_MPI_DYNAMIC_CONNECTION=1'
                                        #- 'I_MPI_CHECK_DAPL_PROVIDER_COMPATIBILITY=0'
                                        # Intel MPI
                                        #- 'DAPL_UCM_REP_TIME=8000'
                                        #- 'DAPL_UCM_RTU_TIME=8000'
                                        #- 'DAPL_UCM_CQ_SIZE=2000'
                                        #- 'DAPL_UCM_QP_SIZE=2000'
                                        #- 'DAPL_UCM_DREQ_RETRY=4'
                                        #- 'DAPL_UCM_WAIT_TIME=10000'
                                        # 1 was used in mkexp, but kills the model with esm-tools
                                        #- 'I_MPI_HARD_FINALIZE=1'
                                        # Intel OpenMP
                                        #- 'KMP_STACKSIZE=64m'
                                        #- 'KMP_AFFINITY=verbose,granularity=fine,compact,1,0'
                                        # OpenMP
                                        - 'OMP_NUM_THREADS=1'

# @JAN: preprocessing and postprocessing scripts needed here
############################################################
#preprocess:
#        preprocess_shell:
#                method: "${general.esm_namelist_dir}/../configs/components/oifs/oifs-43r3-preprocess.sh ${oifs.input_dir}/${oifs.prepifs_startdate}${oifs.hours}/ ${oifs.prepifs_expid} ${oifs.input_expid} ${start_date!syear!smonth!sday} ${oifs.icmcl_end_date_formatted} ${work_dir} ${oifs.wam_number} ${oifs.perturb} ${oifs.nx} ${oifs.ensemble_id}"
#                type: shell
#
#postprocess:
#        postprocess_shell:
#                method: "${general.esm_namelist_dir}/../configs/components/oifs/oifs-43r3-postprocess.sh ${work_dir} ECE3 ${start_date!syear!smonth!sday} ${end_date!syear!smonth!sday}"
#                type: shell

#computer:
#       additional_flags: "--ntasks-per-core=1"
#       launcher: "srun" # default, but set it to make clear what the launcher flags are used for
#       launcher_flags: "-l --kill-on-bad-exit=1 --cpu_bind=cores --distribution=cyclic:cyclic"
#       useMPI: intelmpi17

#########################################################################################
########### necessary changes to submodels compared to standalone setups ################
#########################################################################################

oifs:
        version: "43r3-awi"
        version_dir: "43r3"     # Version for directories

        pool_dir: ${general.pool_dir}
        model_dir: ${general.model_dir}/oifs-${version_dir}
        setup_dir: ${general.model_dir}
        restart_firstlast: "last"
        restart_rate: 12
        ocean_resolution: "${fesom.resolution}"

        mip: "cmip6"
        scenario: "historical"

        input_dir: ${pool_dir}/oifs-${version_dir}
        rtables_dir: ${input_dir}/rtables/
        ##vtables_dir: ${input_dir}/../vtables/
        ##clim_dir: ${input_dir}/../
        ##icmcl_dir: ${input_dir}
        ##icmcl_file: ICMCLgu5aINIT
        forcing_dir: ${input_dir}/${version_dir}/ifsdata/
        ifsdata_dir: ${input_dir}/${version_dir}/ifsdata/
        namelist_dir: ${general.esm_namelist_dir}/oifs/${version_dir}/
        cmip6_data_dir: ${input_dir}/cmip6-data
        cmip5_data_dir: ${input_dir}/cmip5-data


        # nprocb must be 1
        # nproca must be not a prime number for OpenIFS parallelisation to work
        # (This is just one of the many mysteries of the IFS...)
        #
        # We want to use 1 CPU for runoff mapper
        # 287 fulfills this requirement and 288 divides well with 36 and 48
        # (287 = 41 * 7)
        # so that the configuration fills up the compute nodes
        # 575 would also be ok (575 = 23 * 25)
        nproca: 287
        nprocb: 1

        # By default we turn off ECWAM wave model
        wam: False
        # @JAN: in oifs.functions wam: TRUE and wam_2w: TRUE by default

        # namelist_changes:
                # fort.4:
                        # NAMFOCICFG:
                                # Turn on coupling
                                # TODO: Add variable for AGRIF coupling

        resolution: TL159 # @JAN: taken from the runscript, default in oifs.functions is T255
        levels: L60 # @JAN: taken from the runscript, default in oifs.functions is 91

        choose_general.version:
                "1.0":
                        with_xios: True
                        #compiletime_environment_changes:
                        #        add_export_vars:
                        #                - 'OIFS_XIOS=enable'
                        #                - 'OIFS_XIOS_DIR=${general.model_dir}/xios'
                        #                - 'OIFS_XIOS_INCLUDE=-I${general.model_dir}/xios/inc/'
                        #                #- 'OIFS_XIOS_LIB=-L$OIFS_XIOS_DIR/lib -lxios'

        runtime_environment_changes:
                add_export_vars:
                        # Turn on FESOM coupling
                        - 'FESOM_USE_CPLNG="active"'
                        - 'ECE_CPL_NEMO_LIM="false"'
                        - 'ECE_CPL_FESOM_FESIM="true"'
                        - 'ECE_AWI_CPL_FESOM="true"'

        res_number_tl: ${resolution}${levels} # @JOAKIM: what is this variable for? @JAN: Is the directory correct?
        choose_general.resolution:
                TL159_CORE2:
                        nproca: 279 # @JAN, are these numbers correct for this resolution?
                        nprocb: 1

        #@JAN/JOAKIM: is ok to ignore this files?
        remove_input_sources:
                - vtables



fesom:
        version: "2.0"
        resolution: CORE2
        choose_general.resolution:
                TCO159_CORE2:
                        nproca: 288
                        nprocb: 1

        opbnd_dir: ""
        tide_forcing_dir: ""
        forcing_data_dir: ""
        model_dir: ${general.model_dir}/fesom-${fesom.version}
        setup_dir: ${general.model_dir}

        pool_dir: "${general.pool_dir}/fesom2/"
        mesh_dir: "${pool_dir}/core2_meanz/"
        nam_sbc_dir: /work/ollie/dsein/input/forcing/CORE2

        restart_unit: "d"
        leapyear: True

        namelist_changes:
                namelist.config:
                        paths:
                                OpbndPath: "remove_from_namelist"
                                ForcingDataPath: "remove_from_namelist"
                                TideForcingPath: "remove_from_namelist"
                        initialization:
                                oceclimadataname: "remove_from_namelist"
                                use_prepared_init_ice: "remove_from_namelist"
                        restart_log:
                                logfile_outfreq: 960            # @JAN, do we need this?
                                restart_length: "${restart_rate}"
                                run_length_unit: "${restart_unit}"
                        inout:
                                output_offset: "remove_from_namelist"
                                restart_length: "remove_from_namelist"
                                restart_length_unit: "remove_from_namelist"
                                restart_offset: "remove_from_namelist"
                                logfile_outfreq: "remove_from_namelist"
                                use_means: "remove_from_namelist"
                        ale_def:
                                which_ALE: 'linfs'              # @JAN, do we need this?
                                use_partial_cell: false         # @JAN, do we need this?
                        mesh_def:
                                grid_type: "remove_from_namelist"
                                use_ale: "remove_from_namelist"
                                which_ale: "remove_from_namelist"
                                use_partial_cell: "remove_from_namelist"
                                min_hnode: "remove_from_namelist"
                                lzstar_lev: "remove_from_namelist"
                        geometry:
                                betaplane: "remove_from_namelist"
                                f_fplane: "remove_from_namelist"
                                beta_betaplane: "remove_from_namelist"
                        machine:                                # @JAN, this two are different than the default. Do we know why?
                                n_levels: 2
                                n_part: [12, 36]
                namelist.forcing:
                        forcing_source:
                                wind_data_source: "remove_from_namelist"
                                rad_data_source: "remove_from_namelist"
                                precip_data_source: "remove_from_namelist"
                                runoff_data_source: "remove_from_namelist"
                                sss_data_source: "remove_from_namelist"
                                wind_ttp_ind: "remove_from_namelist"
                                rad_ttp_ind: "remove_from_namelist"
                                precip_ttp_ind: "remove_from_namelist"
                                runoff_ttp_ind: "remove_from_namelist"
                                sss_ttp_ind: "remove_from_namelist"
                        namsbc:
                                nm_xwind_file: "remove_from_namelist"
                                nm_ywind_file: "remove_from_namelist"
                                nm_humi_file: "remove_from_namelist"
                                nm_qsr_file: "remove_from_namelist"
                                nm_qlw_file: "remove_from_namelist"
                                nm_tair_file: "remove_from_namelist"
                                nm_prec_file: "remove_from_namelist"
                                nm_snow_file: "remove_from_namelist"
                                nm_mslp_file: "remove_from_namelist"
                                nm_runoff_file: "remove_from_namelist"
                                nm_sss_data_file: "remove_from_namelist"
                        nam_sbc:    # @JAN, do we need this block as it is or could we simplify it?
                                nm_xwind_file: '${nam_sbc_dir}/u_10.'
                                nm_ywind_file: '${nam_sbc_dir}/v_10.'
                                nm_humi_file: '${nam_sbc_dir}/q_10.'
                                nm_qsr_file: '${nam_sbc_dir}/ncar_rad.'
                                nm_qlw_file: '${nam_sbc_dir}/ncar_rad.'
                                nm_tair_file: '${nam_sbc_dir}/t_10.'
                                nm_prec_file: '${nam_sbc_dir}/ncar_precip.'
                                nm_snow_file: '${nam_sbc_dir}/ncar_precip.'
                                nm_mslp_file: '${nam_sbc_dir}/slp.'
                                nm_xwind_var: 'U_10_MOD'
                                nm_ywind_var: 'V_10_MOD'
                                nm_humi_var: 'Q_10_MOD'
                                nm_qsr_var: 'SWDN_MOD'
                                nm_qlw_var: 'LWDN_MOD'
                                nm_tair_var: 'T_10_MOD'
                                nm_prec_var: 'RAIN'
                                nm_snow_var: 'SNOW'
                                nm_mslp_var: 'SLP'
                                nm_nc_iyear: 1948
                                nm_nc_imm: 1
                                nm_nc_idd: 1
                                nm_nc_freq: 1
                                nm_nc_tmid: 1
                                l_xwind: true
                                l_ywind: true
                                l_humi: true
                                l_qsr: true
                                l_qlw: true
                                l_tair: true
                                l_prec: true
                                l_mslp: false
                                l_cloud: false
                                l_snow: true
                                nm_runoff_file: '${nam_sbc_dir}/runoff.nc'
                                runoff_data_source: 'CORE2'
                                nm_sss_data_file: '${nam_sbc_dir}/PHC2_salx.nc'
                                sss_data_source: 'CORE2'
                namelist.oce:
                        boundary:
                                restore_s_surf: 0.0

        coupling_freq_in_steps: $((${oasis3mct.coupling_time_step} / ${fesom.time_step}))

        remove_config_sources:
                - diag


xios:
        #model_dir: ${general.model_dir}/xios-${xios.version}
        #setup_dir: ${general.model_dir}

        nproca: ${computer.cores_per_node}
        nprocb: 1

        #@JAN/JOAKIM: is ok to ignore this files?
        remove_config_sources:
                - ifs_xml


rnfmap:
        #model_dir: ${general.model_dir}/rnfmap-${rnfmap.version}
        #setup_dir: ${general.model_dir}
        nproca: 1
        nprocb: 1
        time_step: ${oasis3mct.coupling_time_step}

#########################################################################################

# Settings for OASIS
oasis3mct:
        model_dir: ${general.model_dir}/oasis
        pool_dir: ${general.pool_dir}/oasis/cy${oifs.version_dir}/${oifs.resolution}-${fesom.resolution}/
        mct_version: 4.0
        norestart: "F"
        use_lucia: True

        process_ordering:
                - fesom
                - oifs
                - rnfmap

        choose_general.version:
                "1.0":
                        add_process_ordering:
                                - xios

        # lresume needs to be true to allow usage of flxatmos and sstocean
        # "restart" files in initial coupling time step
        # but only if the general model setup is a cold start (i.e. general.lresume = false)
        lresume: true
        ini_parent_date: "19500101" # not used, but needs to be present
        ini_parent_exp_id: "khw0030" # not used, but needs to be present
        ini_restart_dir: "${pool_dir}"

        output_exchanged_vars: false

        a2o_lag: "${oifs.time_step}"
        a2r_lag: "${oifs.time_step}"
        o2a_lag: "${fesom.time_step}"
        # MA: check with Joakim which one to choose among these duplicates
        a2o_seq: 3
        #a2o_seq: 1
        o2a_seq: 1

        coupling_time_step: 3600
#        coupling_target_fields:
#                # Coupling ocean fields to atm
#                sstocean:
#                        # - 'AIceFrac:A_SSTSST:A_TepIce:A_IceTck:A_SnwTck:A_OCurx1:A_OCury1 <--o2agauswgt-- OIceFrac:O_SSTSST:O_TepIce:O_IceTck:O_SnwTck:O_OCurx1:O_OCury1'
#                        - 'AIceFrac <--o2agauswgt-- OIceFrac'
#                        - 'A_SSTSST <--o2agauswgt-- O_SSTSST'
#                        - 'A_TepIce <--o2agauswgt-- O_TepIce'
#                        - 'A_IceTck <--o2agauswgt-- O_IceTck'
#                        - 'A_SnwTck <--o2agauswgt-- O_SnwTck'
#                        - 'A_OCurx1 <--o2agauswgt-- O_OCurx1'
#                        - 'A_OCury1 <--o2agauswgt-- O_OCury1'
#
#                # Couple HTESSEL runoff to river routing
#                rnfatm:
#                        - 'R_Runoff_atm <--a2rgauswgt-- A_Runoff'
#
#                # Coupled river routing to ocean runoff mask
#                rnrunoff:
#                        - 'O_Runoff <--r2ogauswgt-- R_Runoff_oce'
#
#                # Couple atm fluxes to ocean (non-conserving)
#                flxatmos:
#                        #- 'O_QsrIce:O_QnsIce:OTotSnow:OIceEvap:O_dQnsdT <--a2ogauswgtnc-- A_QsrIce:A_QnsIce:ATotSnow:AIceEvap:A_dQnsdT'
#                        - 'O_QsrIce <--a2ogauswgtnc-- A_QsrIce'
#                        - 'O_QnsIce <--a2ogauswgtnc-- A_QnsIce'
#                        - 'OTotSnow <--a2ogauswgtnc-- ATotSnow'
#                        - 'OIceEvap <--a2ogauswgtnc-- AIceEvap'
#                        - 'O_dQnsdT <--a2ogauswgtnc-- A_dQnsdT'
#
#                # Coupled atm stress to ocean (non-conserving)
#                atmtau:
#                        #- 'O_OTaux1:O_OTauy1:O_ITaux1:O_ITauy1 <--a2ogauswgtnc-- A_OTaux1:A_OTauy1:A_ITaux1:A_ITauy1'
#                        - 'O_OTaux1 <--a2ogauswgtnc-- A_OTaux1'
#                        - 'O_OTauy1 <--a2ogauswgtnc-- A_OTauy1'
#                        - 'O_ITaux1 <--a2ogauswgtnc-- A_ITaux1'
#                        - 'O_ITauy1 <--a2ogauswgtnc-- A_ITauy1'
#
#                # Couple atm fluxes to ocean (conserving)
#                atmflx:
#                        #- 'O_QsrMix:O_QnsMix:OTotRain <--a2ogauswgtcn-- A_QsrMix:A_QnsMix:ATotRain'
#                        - 'O_QsrMix <--a2ogauswgtcn-- A_QsrMix'
#                        - 'O_QnsMix <--a2ogauswgtcn-- A_QnsMix'
#                        - 'OTotRain <--a2ogauswgtcn-- ATotRain'

        coupling_directions:
                # OIFS dry points to runoff mapper
                'atmr->rnfa':
                        lag: ${a2r_lag}
                        seq: 3
#                # Runoff mapper to runoff points in fesom
#                'opar->opaf':
#                        lag: 0
#                        seq: 3
                # fesom to OIFS wet points including lakes
                'opat->atml':
                        lag: ${o2a_lag}
                        seq: 3
                # OIFS wet points including lakes to fesom including cyclic points
                'atml->opat':
                        lag: ${a2o_lag}
                        seq: 3
                # OIFS wet points excluding lakes to fesom excluding cyclic points
                'atma->opac':
                        lag: ${a2o_lag}
                        seq: 3
                # OIFS wet points including lakes to fesom excluding cyclic points
                'atml->opac':
                        lag: ${a2o_lag}
                        seq: 3


        coupling_methods:
                # fesom to OpenIFS (Lgrid)
                # GAUSWGT remapping. No conservation post processing
                o2agauswgt:
                        time_transformation: average
                        remapping:
                                - gauswgt:
                                        search_bin: latitude
                                        nb_of_neighbours: 9
                                        weight: 2.0
                                - mapping:
                                        mapname: rmp_opat_to_${oifs.oasis_grid_name_l}_GAUSWGT_${fesom.resolution}.nc
                                        map_regrid_on: dst

                # OpenIFS (HTESSEL, Rgrid) to runoff mapper
                # GAUSWGT remapping. GLBPOS conservation.
                a2rgauswgt:
                        time_transformation: average
                        remapping:
                                - gauswgt:
                                        search_bin: latitude
                                        nb_of_neighbours: 9
                                        weight: 2.0
                                - mapping:
                                        mapname: rmp_${oifs.oasis_grid_name_r}_to_rnfa_GAUSWGT.nc
                                        map_regrid_on: src
                        postprocessing:
                                conserv:
                                        method: glbpos

                # Runoff mapper to fesom
                # GAUSWGT remapping. GLBPOS conservation
                # (The grids match exactly, so this is kind of meaningless...)
                r2ogauswgt:
                        time_transformation: average
                        remapping:
                                - gauswgt:
                                        search_bin: latitude
                                        nb_of_neighbours: 9
                                        weight: 2.0
                                - mapping:
                                        mapname: rmp_opar_to_opaf_GAUSWGT_${fesom.resolution}.nc
                                        map_regrid_on: dst
                        postprocessing:
                                conserv:
                                        method: glbpos

                # OpenIFS (Lgrid) to fesom
                # GAUSWGT remapping. No conservation post processing.
                a2ogauswgtnc:
                        time_transformation: average
                        remapping:
                                - gauswgt:
                                        search_bin: latitude
                                        nb_of_neighbours: 9
                                        weight: 2.0
                                - mapping:
                                        mapname: rmp_${oifs.oasis_grid_name_l}_to_opat_GAUSWGT_${fesom.resolution}.nc
                                        map_regrid_on: src

                # OpenIFS (Agrid) to fesom
                # GAUSWGT remapping. GLBPOS conservation.
                a2ogauswgtcn:
                        time_transformation: average
                        remapping:
                                - gauswgt:
                                        search_bin: latitude
                                        nb_of_neighbours: 9
                                        weight: 2.0
                                - mapping:
                                        mapname: rmp_${oifs.oasis_grid_name_a}_to_opac_GAUSWGT_${fesom.resolution}.nc
                                        map_regrid_on: src
                        postprocessing:
                                conserv:
                                        method: glbpos

                # OpenIFS (Lgrid) to AGRIF
                # GAUSWGT remapping. No conservation post processing.
                a2agrgauswgtnc:
                        time_transformation: average
                        remapping:
                                - gauswgt:
                                        search_bin: latitude
                                        nb_of_neighbours: 9
                                        weight: 2.0
                                - mapping:
                                        mapname: rmp_${oifs.oasis_grid_name_l}_to_agr1_GAUSWGT_${fesom.resolution}.nc
                                        map_regrid_on: src

                # OpenIFS (Agrid) to AGRIF
                # GAUSWGT remapping. No conservation post processing.
                a2agrgauswgtcn:
                        time_transformation: average
                        remapping:
                                - gauswgt:
                                        search_bin: latitude
                                        nb_of_neighbours: 9
                                        weight: 2.0
                                - mapping:
                                        mapname: rmp_${oifs.oasis_grid_name_a}_to_agr1_GAUSWGT_${fesom.resolution}.nc
                                        map_regrid_on: src

                # AGRIF to OpenIFS (Lgrid)
                # GAUSWGT remapping. No conservation post processing
                agr2agauswgt:
                        time_transformation: average
                        remapping:
                                - gauswgt:
                                        search_bin: latitude
                                        nb_of_neighbours: 25
                                        weight: 2.0
                                - mapping:
                                        mapname: rmp_agr1_to_${oifs.oasis_grid_name_l}_GAUSWGT_${fesom.resolution}.nc
                                        map_regrid_on: dst

                # AGRIF mask to OpenIFS (Lgrid)
                # GAUSWGT remapping. No conservation post processing
                agr22agauswgt:
                        time_transformation: average
                        remapping:
                                - gauswgt:
                                        search_bin: latitude
                                        nb_of_neighbours: 25
                                        weight: 2.0
                                - mapping:
                                        mapname: rmp_agr2_to_${oifs.oasis_grid_name_l}_GAUSWGT_${fesom.resolution}.nc
                                        map_regrid_on: dst

        add_input_files:
                areas: areas
                masks: masks
                grids: grids

        add_input_in_work:
                areas: areas.nc
                masks: masks.nc
                grids: grids.nc

        # @JOAKIM: ok to remove?
        #add_input_sources:
        #        areas: ${pool_dir}/grids_areas_masks.nc
        #        masks: ${pool_dir}/grids_areas_masks.nc
        #        grids: ${pool_dir}/grids_areas_masks.nc

        add_restart_out_files:
                rmp_a2f_B: rmp_a2f_B
                rmp_f2a_G: rmp_f2a_G
                rmp_a2r_B: rmp_a2r_B
                rmp_r2f_G: rmp_r2f_G

        add_restart_out_in_work:
                rmp_a2f_B: ${fesom.nproc}/rmp_${oifs.oasis_grid_name_a}_to_feom_BICUBIC.nc
                rmp_f2a_G: ${fesom.nproc}/rmp_feom_to_${oifs.oasis_grid_name_a}_GAUSWGT.nc
                rmp_a2r_B: ${fesom.nproc}/rmp_${oifs.oasis_grid_name_r}_to_RnfA_BICUBIC.nc
                rmp_r2f_G: ${fesom.nproc}/rmp_RnfO_to_feom_GAUSWGT.nc

        add_restart_out_sources:
                rmp_a2f_B: ${fesom.nproc}/rmp_${oifs.oasis_grid_name_a}_to_feom_BICUBIC.nc
                rmp_f2a_G: ${fesom.nproc}/rmp_feom_to_${oifs.oasis_grid_name_a}_GAUSWGT.nc
                rmp_a2r_B: ${fesom.nproc}/rmp_${oifs.oasis_grid_name_r}_to_RnfA_BICUBIC.nc
                rmp_r2f_G: ${fesom.nproc}/rmp_RnfO_to_feom_GAUSWGT.nc

        add_restart_in_files:
                rmp_a2f_B: rmp_a2f_B
                rmp_f2a_G: rmp_f2a_G
                rmp_a2r_B: rmp_a2r_B
                rmp_r2f_G: rmp_r2f_G

        add_restart_in_in_work:
                rmp_a2f_B: ${fesom.nproc}/rmp_${oifs.oasis_grid_name_a}_to_feom_BICUBIC.nc
                rmp_f2a_G: ${fesom.nproc}/rmp_feom_to_${oifs.oasis_grid_name_a}_GAUSWGT.nc
                rmp_a2r_B: ${fesom.nproc}/rmp_${oifs.oasis_grid_name_r}_to_RnfA_BICUBIC.nc
                rmp_r2f_G: ${fesom.nproc}/rmp_RnfO_to_feom_GAUSWGT.nc

        add_restart_in_sources:
                rmp_a2f_B: ${fesom.nproc}/rmp_${oifs.oasis_grid_name_a}_to_feom_BICUBIC.nc
                rmp_f2a_G: ${fesom.nproc}/rmp_feom_to_${oifs.oasis_grid_name_a}_GAUSWGT.nc
                rmp_a2r_B: ${fesom.nproc}/rmp_${oifs.oasis_grid_name_r}_to_RnfA_BICUBIC.nc
                rmp_r2f_G: ${fesom.nproc}/rmp_RnfO_to_feom_GAUSWGT.nc


# Set up CPU layout
choose_cores_per_node:
        24:
                choose_resolution:
                        T159_CORE2:
                                oifs:
                                        nproca: 287
                                        nprocb: 1
                                fesom:
                                        nproca: 288
                                        nprocb: 1
                                xios:
                                        nproca: 24
                                        nprocb: 1
                                rnfmap:
                                        nproca: 1
                                        nprocb: 1
                        T511_CORE2:
                                oifs:
                                        nproca: 1536
                                        nprocb: 1
                                fesom:
                                        nproca: 24
                                        nprocb: 1
                                xios:
                                        nproca: 24
                                        nprocb: 1
                                rnfmap:
                                        nproca: 1
                                        nprocb: 1
        36:
                choose_resolution:
                        T159_CORE2:
                                oifs:
                                        nproca: 395
                                        nprocb: 1
                                fesom:
                                        nproca: 72
                                        nprocb: 1
                                xios:
                                        nproca: 36
                                        nprocb: 1
                                rnfmap:
                                        nproca: 1
                                        nprocb: 1
                        T511_CORE2:
                                oifs:
                                        nproca: 1512
                                        nprocb: 1
                                fesom:
                                        nproca: 36
                                        nprocb: 1
                                xios:
                                        nproca: 36
                                        nprocb: 1
                                rnfmap:
                                        nproca: 1
                                        nprocb: 1
        40:
                choose_resolution:
                        T159_CORE2:
                                oifs:
                                        nproca: 400
                                        nprocb: 1
                                fesom:
                                        nproca: 400
                                        nprocb: 1
                                xios:
                                        nproca: 40
                                        nprocb: 1
                                rnfmap:
                                        nproca: 1
                                        nprocb: 1
                        T511_CORE2:
                                oifs:
                                        nproca: 2000
                                        nprocb: 1
                                fesom:
                                        nproca: 400
                                        nprocb: 1
                                xios:
                                        nproca: 40
                                        nprocb: 1
                                rnfmap:
                                        nproca: 1
                                        nprocb: 1
